(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{127:function(e,n,a){"use strict";a.r(n);var t=a(0),o=a.n(t),r=a(146),c=a(160),m=a.n(c),s=(a(28),a(148)),l=a(183),p=(a(145),a(189)),i=a(190),u=a.n(i),d=a(339),g=a.n(d),E=a(340),T=a.n(E),D=a(341),f=a.n(D),M=Object.assign({},p.dark,{codeSurfer:Object.assign({},u.a,{showNumbers:!0})}),X=(new Date("2018-11-02T00:00:00.000Z"),[function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h1",components:n},"About ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h1"},"loc")," pragma"),o.a.createElement(s.MDXTag,{name:"h2",components:n},"TSUYUSATO Kitsune (@MakeNowJust)"))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"About Me"),o.a.createElement(s.MDXTag,{name:"ul",components:n},o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"TSUYUSATO Kitsune"),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"GitHub: @MakeNowJust"),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"Twitter: @make_now_just"),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"Frontend Engineer at Space Pirates LLC.")))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"No.4 Crystal Contributor"),o.a.createElement("img",{src:g.a}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"loc")," pragma?"),o.a.createElement(s.MDXTag,{name:"ul",components:n},o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"One of the hidden (undocumented) features of Crystal"),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"It can update location on parsing explicitly.")),o.a.createElement("img",{src:T.a}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"Example: ECR"))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"How ECR works"),o.a.createElement(s.MDXTag,{name:"ol",components:n},o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ol"},"Macro ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"ECR.def_to_s")," calls ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"run")," macro with ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"ecr/process")," and given ECR file."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ol"},"Program ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"ecr/process")," prints Crystal source code generated from given ECR file."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ol"},"Then, this generated source code is embeded as a ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"ECR.def_to_s")," result.")))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"ecr-sample.cr",code:a(342).trim(),lang:"ruby"}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"ecr-sample.ecr",code:a(343).trim(),lang:"html",steps:[{},{lines:[6],notes:'"tilte" is misspelled...'}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"Execute ecr-sample.cr",code:a(344).trim(),lang:"text",steps:[{},{lines:[31,32,33,34],notes:"show correct location instead of generated code location"}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"How does ECR tell original source code location to compiler?"))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"Run ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"ecr/process")," at hand."),o.a.createElement(s.MDXTag,{name:"pre",components:n},o.a.createElement(s.MDXTag,{name:"code",components:n,parentName:"pre",props:{metaString:null}},"$ echo 'require \"ecr/process\"' |\n    crystal run --stdin-filename process.cr -- ecr-sample.ecr ___io___\n")),o.a.createElement(s.MDXTag,{name:"p",components:n},"(MEMO: the second command-line argument of ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"ecr/process")," means a variable name to write output.)"))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"Result of ecr-sample.ecr",code:a(345).trim(),lang:"ruby",steps:[{},{lines:[1,3,5],notes:"These lines are corresponding to literal texts simply."},{lines:[2,4],notes:"These line are corresponding to <%= ... %>, however, what is #<loc:...>?"}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"loc")," pragma syntax"),o.a.createElement(s.MDXTag,{name:"ul",components:n},o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},'#<loc:"filename",line_number,column_number>')),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"Override parsing location as given values."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"It looks like line comment, but it is not a comment."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"So, source code after ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"loc")," pragma is also parsed.")))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"loc")," pragma syntax (",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"push")," and ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"pop"),")"),o.a.createElement(s.MDXTag,{name:"ul",components:n},o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"#<loc:push>")," and ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"#<loc:pop>")),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"#<loc:push>")," saves current location."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"#<loc:pop>")," restores the location saved by previous ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"#<loc:push>"),".")),o.a.createElement(s.MDXTag,{name:"p",components:n},"It is useful to distinguish between macro generated code and original code."))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"Example: fix macro argument location"))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"new.cr",code:a(346).trim(),lang:"ruby",steps:[{},{lines:[5],notes:"BadType is not defined of course."}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"Execute new.cr",code:a(347).trim(),lang:"text",steps:[{},{lines:[11,12,13],notes:"Show macro generated code. But is it useful?"}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"new.cr with loc pragma",code:a(348).trim(),lang:"ruby",steps:[{},{lines:[2],notes:"Build loc pragma by hand."}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(l.CodeSurfer,{title:"Execute new.cr with loc pragma",code:a(349).trim(),lang:"text",steps:[{notes:"Then, it shows really clear error message."}]}))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"If all expanded macro argument outputs its ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"h2"},"loc")," pragma..."),o.a.createElement(s.MDXTag,{name:"ul",components:n},o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"I think it is more natural and useful."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"However ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"loc")," pragma is just text, so it causes some issues. e.g."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"When macro expansion appears in ",o.a.createElement(s.MDXTag,{name:"strong",components:n,parentName:"li"},"doc comment"),"..."),o.a.createElement(s.MDXTag,{name:"li",components:n,parentName:"ul"},"When macro expansion appears in ",o.a.createElement(s.MDXTag,{name:"strong",components:n,parentName:"li"},"string literal"),"...")),o.a.createElement(s.MDXTag,{name:"p",components:n},"So, currently the compiler does not outputs ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"loc")," pragma for macro argument."))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},"But now,"),o.a.createElement(s.MDXTag,{name:"p",components:n},"I created a new Pull Request with new approach."))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h2",components:n},o.a.createElement(s.MDXTag,{name:"a",components:n,parentName:"h2",props:{href:"https://github.com/crystal-lang/crystal/pull/7008"}},"crystal-lang/crystal#7008")),o.a.createElement("img",{src:f.a}),o.a.createElement(s.MDXTag,{name:"p",components:n},"It does not outputs ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"loc")," pragma directly, but it keeps ",o.a.createElement(s.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"loc")," pragmas as internal data."),o.a.createElement(s.MDXTag,{name:"p",components:n},"Unfortunately it is not merged..."))},function(e){var n=e.components;m()(e,["components"]);return o.a.createElement(s.MDXTag,{name:"wrapper",components:n},o.a.createElement(s.MDXTag,{name:"h1",components:n},"Stay tuned ❤️"))}]);a.d(n,"query",function(){return h});n.default=function(e){var n=e.data;return o.a.createElement(r.a,{data:n,slides:X,theme:M})};var h="2617449398"},146:function(e,n,a){"use strict";a(66),a(47);var t=a(147),o=a(4),r=a.n(o),c=a(0),m=a.n(c),s=a(145),l=(a(159),t.updaters.previous),p=t.updaters.next,i=t.updaters.decrementIndex,u=t.updaters.incrementIndex,d=t.updaters.decrementStep,g=t.updaters.incrementStep,E=t.updaters.toggleMode,T=t.constants.keys,D=m.a.memo(function(e){var n=e.data,a=e.slides,o=e.theme,r=m.a.createRef(),D=m.a.createRef();Object(c.useEffect)(function(){D.current.focus()});var f=n.site.siteMetadata.title,M=n.file.fields.frontmatter.title+" - "+f;return m.a.createElement(m.a.Fragment,null,m.a.createElement(s.Helmet,null,m.a.createElement("title",null,M)),m.a.createElement("div",{ref:D,role:"presentation",tabIndex:"-1",onKeyDown:function(e){if(document.activeElement===D.current&&!e.metaKey&&!e.ctrlKey){var n=r.current,a=e.altKey&&!e.shiftKey,t=e.shiftKey&&!e.altKey;if(a)switch(e.keyCode){case T.p:n.update(E("presenter"));break;case T.o:n.update(E("overview"));break;case T.g:n.update(E("grid"))}else if(t)switch(e.keyCode){case T.right:case T.pageDown:e.preventDefault(),n.update(u);break;case T.left:case T.pageUp:e.preventDefault(),n.update(i)}else if(!a&&!t)switch(e.keyCode){case T.right:case T.pageDown:case T.space:e.preventDefault(),n.update(p);break;case T.left:case T.pageUp:e.preventDefault(),n.update(l);break;case T.up:n.update(d);break;case T.down:n.update(g)}}}},m.a.createElement(t.SlideDeck,{ref:r,slides:a,theme:o})))});D.propTypes={data:r.a.object.isRequired,slides:r.a.array.isRequired,theme:r.a.object.isRequired},n.a=D},339:function(e,n,a){e.exports=a.p+"static/contributors-6b0cbdfa111bd0ea291cca734dc55074.png"},340:function(e,n,a){e.exports=a.p+"static/search-loc-pragma-be7fed0101a863fe3b9b187b38bb31c7.png"},341:function(e,n,a){e.exports=a.p+"static/pr-7008-12e796a08a1745838305740da6a80cef.png"},342:function(e,n){e.exports='require "ecr"\n\nclass Foo\n  getter title\n\n  def initialize(@title : String)\n  end\n\n  ECR.def_to_s "#{__DIR__}/foo.ecr"\nend\n\nputs Foo.new("hello world").to_s\n'},343:function(e,n){e.exports="<html>\n  <head>\n    <title><%= title %></title>\n  </head>\n  <body>\n    <h1><%= tilte %></h1>\n  </body>\n</html>\n"},344:function(e,n){e.exports="Error in foo.cr:12: instantiating 'Foo#to_s()'\n\nputs Foo.new(\"hello world\").to_s\n                            ^~~~\n\nin .../src/object.cr:95: instantiating 'String.class#build()'\n\n    String.build do |io|\n           ^~~~~\n\nin .../src/string.cr:268: instantiating 'String::Builder.class#build(Int32)'\n\n    String::Builder.build(capacity) do |builder|\n                    ^~~~~\n\nin .../src/string.cr:268: instantiating 'String::Builder.class#build(Int32)'\n\n    String::Builder.build(capacity) do |builder|\n                    ^~~~~\n\nin .../src/object.cr:95: instantiating 'String.class#build()'\n\n    String.build do |io|\n           ^~~~~\n\nin .../src/object.cr:96: instantiating 'to_s(String::Builder)'\n\n      to_s io\n      ^~~~\n\nin foo.ecr:6: undefined local variable or method 'tilte'\n\n    <h1><%= tilte %></h1>\n            ^~~~~\n"},345:function(e,n){e.exports='___io___ << "<html>\\n  <head>\\n    <title>"\n(title).to_s ___io___\n___io___ << "</title>\\n  </head>\\n  <body>\\n    <h1>"\n(tilte).to_s ___io___\n___io___ << "</h1>\\n  </body>\\n</html>\\n"\n'},346:function(e,n){e.exports="macro new(node)\n  {{node}}.new\nend\n\nnew BadType\n"},347:function(e,n){e.exports="Error in new.cr:5: expanding macro\n\nnew BadType\n^~~\n\nin new.cr:5: expanding macro\n\nnew BadType\n^\n\nin macro 'new' new.cr:1, line 1:\n\n>  1.   BadType.new\n\nundefined constant BadType\n"},348:function(e,n){e.exports="macro new(node)\n  #<loc:{{node.filename}},{{node.line_number}},{{node.column_number}}>{{node}}.new\nend\n\nnew BadType\n"},349:function(e,n){e.exports="Error in new.cr:5: expanding macro\n\nnew BadType\n^~~\n\nin new.cr:5: undefined constant BadType\n\nnew BadType\n    ^~~~~~~\n"}}]);
//# sourceMappingURL=component---cache-mdx-deck-template-620-b-7-ad-8-f-6-fadeec-57-d-1-c-85-cf-301-a-6-d-8-js-4a1d266475803fa6df71.js.map